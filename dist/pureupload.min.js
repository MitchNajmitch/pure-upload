var UploadStatusStatic=function(){function t(){}return t.queued="queued",t.uploading="uploading",t.uploaded="uploaded",t.failed="failed",t.canceled="canceled",t.removed="removed",t}(),uploadStatus=UploadStatusStatic,getUploadCore=function(t,e){return new UploaderCore(t,e)},UploaderCore=function(){function t(t,e){this.options=t,this.callbacks=e,this.setFullOptions(t),this.setFullCallbacks(e)}return t.prototype.upload=function(t){var e=this,o=this.castFiles(t);o.forEach(function(t){return e.processFile(t)})},t.prototype.processFile=function(t){var e=this.createRequest();this.setCallbacks(e,t),this.send(e,t)},t.prototype.castFiles=function(t){var e;return e="object"==typeof t?Object.keys(t).map(function(e){return t[e]}):t,e.forEach(function(t){t.uploadStatus=uploadStatus.uploading,t.responseCode=0,t.responseText="",t.progress=0,t.sentBytes=0,t.cancel=function(){}}),e},t.prototype.createRequest=function(){var t=new XMLHttpRequest;return t.open(this.options.method,this.options.url,!0),t.withCredentials=!!this.options.withCredentials,this.setHeaders(t),t},t.prototype.setHeaders=function(t){var e=this;this.options.headers.Accept=this.options.headers.Accept||"application/json",this.options.headers["Cache-Control"]=this.options.headers["Cache-Control"]||"no-cache",this.options.headers["X-Requested-With"]=this.options.headers["X-Requested-With"]||"XMLHttpRequest",Object.keys(this.options.headers).forEach(function(o){var a=e.options.headers[o];void 0!=a&&t.setRequestHeader(o,a)})},t.prototype.setCallbacks=function(t,e){var o=this;e.cancel=function(){t.abort(),e.uploadStatus=uploadStatus.canceled,o.callbacks.onCancelledCallback(e),o.callbacks.onFinishedCallback(e)},t.onload=function(a){return o.onload(e,t)},t.onerror=function(){return o.handleError(e,t)},t.upload.onprogress=function(t){return o.updateProgress(e,t)}},t.prototype.send=function(t,e){var o=this.createFormData(e);this.callbacks.onUploadStartedCallback(e),t.send(o)},t.prototype.createFormData=function(t){var e=this,o=new FormData;return Object.keys(this.options.params).forEach(function(t){var a=e.options.params[t];void 0!=a&&o.append(t,a)}),o.append("file",t,t.name),o},t.prototype.handleError=function(t,e){t.uploadStatus=uploadStatus.failed,this.setResponse(t,e),this.callbacks.onErrorCallback(t),this.callbacks.onFinishedCallback(t)},t.prototype.updateProgress=function(t,e){null!=e?(t.progress=Math.round(100*(e.loaded/e.total)),t.sentBytes=e.loaded):(t.progress=100,t.sentBytes=t.size),t.uploadStatus=100===t.progress?uploadStatus.uploaded:uploadStatus.uploading,this.callbacks.onProgressCallback(t)},t.prototype.onload=function(t,e){4===e.readyState&&(100!=t.progress&&this.updateProgress(t),200===e.status?this.finished(t,e):this.handleError(t,e))},t.prototype.finished=function(t,e){t.uploadStatus=uploadStatus.uploaded,this.setResponse(t,e),this.callbacks.onUploadedCallback(t),this.callbacks.onFinishedCallback(t)},t.prototype.setResponse=function(t,e){t.responseCode=e.status,t.responseText=e.statusText||e.status?e.status.toString():"Invalid response from server"},t.prototype.setFullOptions=function(t){this.options.url=t.url,this.options.method=t.method,this.options.headers=t.headers||{},this.options.params=t.params||{},this.options.withCredentials=t.withCredentials||!1},t.prototype.setFullCallbacks=function(t){this.callbacks.onProgressCallback=t.onProgressCallback||function(){},this.callbacks.onCancelledCallback=t.onCancelledCallback||function(){},this.callbacks.onFinishedCallback=t.onFinishedCallback||function(){},this.callbacks.onUploadedCallback=t.onUploadedCallback||function(){},this.callbacks.onErrorCallback=t.onErrorCallback||function(){},this.callbacks.onUploadStartedCallback=t.onUploadStartedCallback||function(){}},t}(),UploadQueue=function(){function t(t,e){this.options=t,this.callbacks=e,this.queuedFiles=[],this.setFullOptions(),this.setFullCallbacks()}return t.prototype.filesChanged=function(){this.options.autoRemove&&this.removeFinishedFiles(),this.options.autoStart&&this.startWaitingFiles(),this.checkAllFinished(),this.callbacks.onQueueChangedCallback(this.queuedFiles)},t.prototype.checkAllFinished=function(){var t=this.queuedFiles.filter(function(t){return[uploadStatus.queued,uploadStatus.uploading].indexOf(t.uploadStatus)>=0});0==t.length&&this.callbacks.onAllFinishedCallback()},t.prototype.addFiles=function(t){var e=this;t.forEach(function(t){e.queuedFiles.push(t),t.uploadStatus=uploadStatus.queued,t.remove=function(){e.removeFile(t)},t.start||(t.start=function(){}),t.cancel||(t.cancel=function(){}),e.callbacks.onFileAddedCallback(t)}),this.filesChanged()},t.prototype.removeFile=function(t){var e=this.queuedFiles.indexOf(t);0>e||(this.deactivateFile(t),this.queuedFiles.splice(e,1),this.callbacks.onFileRemovedCallback(t),this.filesChanged())},t.prototype.clearFiles=function(){var t=this;this.queuedFiles.forEach(function(e){return t.deactivateFile(e)}),this.queuedFiles=[]},t.prototype.setFullOptions=function(){this.options.maxParallelUploads=this.options.maxParallelUploads||0,this.options.autoStart=this.options.autoStart||!1,this.options.autoRemove=this.options.autoRemove||!1},t.prototype.setFullCallbacks=function(){this.callbacks.onFileAddedCallback=this.callbacks.onFileAddedCallback||function(){},this.callbacks.onFileRemovedCallback=this.callbacks.onFileRemovedCallback||function(){},this.callbacks.onAllFinishedCallback=this.callbacks.onAllFinishedCallback||function(){},this.callbacks.onQueueChangedCallback=this.callbacks.onQueueChangedCallback||function(){}},t.prototype.startWaitingFiles=function(){this.getWaitingFiles().forEach(function(t){return t.start()})},t.prototype.removeFinishedFiles=function(){var t=this;this.queuedFiles.filter(function(t){return[uploadStatus.uploaded,uploadStatus.failed,uploadStatus.canceled].indexOf(t.uploadStatus)>=0}).forEach(function(e){return t.removeFile(e)})},t.prototype.deactivateFile=function(t){t.uploadStatus==uploadStatus.uploading&&t.cancel(),t.uploadStatus=uploadStatus.removed,t.cancel=function(){},t.remove=function(){},t.start=function(){}},t.prototype.getWaitingFiles=function(){if(!this.options.autoStart)return[];var t=this.queuedFiles.filter(function(t){return t.uploadStatus==uploadStatus.queued});if(this.options.maxParallelUploads>0){var e=this.queuedFiles.filter(function(t){return t.uploadStatus==uploadStatus.uploading}).length,o=this.options.maxParallelUploads-e;if(0>=o)return[];t=t.slice(0,o)}return t},t}(),UploadArea=function(){function t(t,e,o){this.targetElement=t,this.options=e,this.uploader=o,this.uploadCore=getUploadCore(this.options,this.uploader.queue.callbacks),this.setupHiddenInput()}return t.prototype.putFilesToQueue=function(t){var e;e=t[0];var o;o=[],o.push(e);var a=this;e.start=function(){a.uploadCore.upload(o),e.start=function(){}},this.uploader.queue.addFiles(o)},t.prototype.setupHiddenInput=function(){var t=this,e=document.createElement("input");e.setAttribute("type","file"),e.style.display="none",e.accept=this.options.accept,this.options.multiple&&e.setAttribute("multiple",""),this.uploader.uploaderOptions.autoStart&&e.addEventListener("change",function(e){console.log("changed"),console.log(e),t.putFilesToQueue(e.target.files)}),this.options.clickable&&this.targetElement.addEventListener("click",function(t){e.click()}),this.options.allowDragDrop&&(this.targetElement.addEventListener("dragover",function(e){var o;try{o=e.dataTransfer.effectAllowed}catch(a){}e.dataTransfer.dropEffect="move"===o||"linkMove"===o?"move":"copy",t.stopEventPropagation(e)}),this.targetElement.addEventListener("drop",function(e){if(e.dataTransfer){var o=e.dataTransfer.files;if(o.length){var a=e.dataTransfer.files;t.putFilesToQueue(a)}t.stopEventPropagation(e)}})),document.body.appendChild(e)},t.prototype.stopEventPropagation=function(t){t.stopPropagation(),t.preventDefault&&t.preventDefault()},t}(),getUploader=function(t,e){return new Uploader(t,e)},Uploader=function(){function t(t,e){this.setOptions(t),this.uploadAreas=[],this.queue=new UploadQueue(t,e)}return t.prototype.setOptions=function(t){this.uploaderOptions=t},t.prototype.registerArea=function(t,e){var o=new UploadArea(t,e,this);this.uploadAreas.push(o)},t.prototype.unregisterArea=function(t){var e=this.uploadAreas.indexOf(t);e>=0&&this.uploadAreas.splice(e,1)},t}();