var pu;!function(t){function e(t,e){var n;return n="object"==typeof t?Object.keys(t).map(function(e){return t[e]}):t,n.forEach(function(t){t.uploadStatus=e||t.uploadStatus,t.responseCode=t.responseCode||0,t.responseText=t.responseText||"",t.progress=t.progress||0,t.sentBytes=t.sentBytes||0,t.cancel=t.cancel||function(){}}),n}function n(t,e,n){return void 0===n&&(n=!1),t?n?function(){e(),t()}:function(){t(),e()}:e}function a(){var t=(new Date).getTime(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:3&n|8).toString(16)});return e}t.castFiles=e,t.decorateSimpleFunction=n,t.getUploadCore=function(t,e){return new i(t,e)},t.getUploader=function(t,e){return new s(t,e)},t.newGuid=a;var o=function(){function n(e,n,a){this.targetElement=e,this.options=n,this.uploader=a,this.uploadCore=t.getUploadCore(this.options,this.uploader.queue.callbacks),this.setupHiddenInput()}return n.prototype.putFilesToQueue=function(t){var n=this,a=e(t);a.forEach(function(t){t.start=function(){n.uploadCore.upload([t]),t.start=function(){}}}),this.uploader.queue.addFiles(a)},n.prototype.setupHiddenInput=function(){var t=this;this.fileInput=document.createElement("input"),this.fileInput.setAttribute("type","file"),this.fileInput.style.display="none",this.fileInput.accept=this.options.accept;var e=function(e){return t.onChange(e)};if(this.fileInput.addEventListener("change",e),this.unregisterOnChange=function(){return t.fileInput.removeEventListener("onChange",onchange)},this.options.multiple&&this.fileInput.setAttribute("multiple",""),this.options.clickable){var n=function(){return t.onClick()};this.targetElement.addEventListener("click",n),this.unregisterOnClick=function(){return t.targetElement.removeEventListener("click",n)}}if(this.options.allowDragDrop){var a=function(e){return t.onDrag(e)};this.targetElement.addEventListener("dragover",a),this.unregisterOnDragOver=function(){return t.targetElement.removeEventListener("dragover",a)};var o=function(e){return t.onDrop(e)};this.targetElement.addEventListener("drop",o),this.unregisterOnDrop=function(){return t.targetElement.removeEventListener("drop",o)}}document.body.appendChild(this.fileInput)},n.prototype.onChange=function(t){this.putFilesToQueue(t.target.files)},n.prototype.onDrag=function(t){var e;try{e=t.dataTransfer.effectAllowed}catch(n){}t.dataTransfer.dropEffect="move"===e||"linkMove"===e?"move":"copy",this.stopEventPropagation(t)},n.prototype.onDrop=function(t){if(t.dataTransfer){var e=t.dataTransfer.files;if(e.length){var n=t.dataTransfer.files;this.putFilesToQueue(n)}this.stopEventPropagation(t)}},n.prototype.onClick=function(){this.fileInput.value="",this.fileInput.click()},n.prototype.stopEventPropagation=function(t){t.stopPropagation(),t.preventDefault&&t.preventDefault()},n.prototype.destroy=function(){this.unregisterOnClick&&this.unregisterOnClick(),this.unregisterOnDrop&&this.unregisterOnDrop(),this.unregisterOnChange&&this.unregisterOnChange(),this.unregisterOnDragOver&&this.unregisterOnDragOver(),this.targetElement.removeEventListener("dragover",this.onDrag),this.targetElement.removeEventListener("drop",this.onDrop),document.body.removeChild(this.fileInput)},n}();t.UploadArea=o;var i=function(){function a(t,e){this.options=t,this.callbacks=e,this.setFullOptions(t),this.setFullCallbacks(e)}return a.prototype.upload=function(n){var a=this,o=e(n,t.uploadStatus.uploading);o.forEach(function(t){return a.processFile(t)})},a.prototype.processFile=function(t){var e=this.createRequest();this.setCallbacks(e,t),this.send(e,t)},a.prototype.createRequest=function(){var t=new XMLHttpRequest;return t.open(this.options.method,this.options.url,!0),t.withCredentials=!!this.options.withCredentials,this.setHeaders(t),t},a.prototype.setHeaders=function(t){var e=this;this.options.headers.Accept=this.options.headers.Accept||"application/json",this.options.headers["Cache-Control"]=this.options.headers["Cache-Control"]||"no-cache",this.options.headers["X-Requested-With"]=this.options.headers["X-Requested-With"]||"XMLHttpRequest",Object.keys(this.options.headers).forEach(function(n){var a=e.options.headers[n];void 0!=a&&t.setRequestHeader(n,a)})},a.prototype.setCallbacks=function(e,a){{var o=this;a.cancel}a.cancel=n(a.cancel,function(){e.abort(),a.uploadStatus=t.uploadStatus.canceled,o.callbacks.onCancelledCallback(a),o.callbacks.onFileStateChangedCallback(a),o.callbacks.onFinishedCallback(a)},!0),e.onload=function(t){return o.onload(a,e)},e.onerror=function(){return o.handleError(a,e)},e.upload.onprogress=function(t){return o.updateProgress(a,t)}},a.prototype.send=function(t,e){var n=this.createFormData(e);this.callbacks.onUploadStartedCallback(e),this.callbacks.onFileStateChangedCallback(e),t.send(n)},a.prototype.createFormData=function(t){var e=this,n=new FormData;return Object.keys(this.options.params).forEach(function(t){var a=e.options.params[t];void 0!=a&&n.append(t,a)}),n.append("file",t,t.name),n},a.prototype.handleError=function(e,n){e.uploadStatus=t.uploadStatus.failed,this.setResponse(e,n),this.callbacks.onErrorCallback(e),this.callbacks.onFileStateChangedCallback(e),this.callbacks.onFinishedCallback(e)},a.prototype.updateProgress=function(e,n){null!=n?(e.progress=Math.round(100*(n.loaded/n.total)),e.sentBytes=n.loaded):(e.progress=100,e.sentBytes=e.size),e.uploadStatus=100===e.progress?t.uploadStatus.uploaded:t.uploadStatus.uploading,this.callbacks.onProgressCallback(e)},a.prototype.onload=function(t,e){4===e.readyState&&(100!=t.progress&&this.updateProgress(t),200===e.status?this.finished(t,e):this.handleError(t,e))},a.prototype.finished=function(e,n){e.uploadStatus=t.uploadStatus.uploaded,this.setResponse(e,n),this.callbacks.onUploadedCallback(e),this.callbacks.onFileStateChangedCallback(e),this.callbacks.onFinishedCallback(e)},a.prototype.setResponse=function(t,e){t.responseCode=e.status,t.responseText=e.statusText||e.status?e.status.toString():"Invalid response from server"},a.prototype.setFullOptions=function(t){this.options.url=t.url,this.options.method=t.method,this.options.headers=t.headers||{},this.options.params=t.params||{},this.options.withCredentials=t.withCredentials||!1},a.prototype.setFullCallbacks=function(t){this.callbacks.onProgressCallback=t.onProgressCallback||function(){},this.callbacks.onCancelledCallback=t.onCancelledCallback||function(){},this.callbacks.onFinishedCallback=t.onFinishedCallback||function(){},this.callbacks.onUploadedCallback=t.onUploadedCallback||function(){},this.callbacks.onErrorCallback=t.onErrorCallback||function(){},this.callbacks.onUploadStartedCallback=t.onUploadStartedCallback||function(){},this.callbacks.onFileStateChangedCallback=t.onFileStateChangedCallback||function(){}},a}();t.UploadCore=i;var s=function(){function t(t,e){this.setOptions(t),this.uploadAreas=[],this.queue=new l(t,e)}return t.prototype.setOptions=function(t){this.uploaderOptions=t},t.prototype.registerArea=function(t,e){var n=new o(t,e,this);return this.uploadAreas.push(n),n},t.prototype.unregisterArea=function(t){var e=this.uploadAreas.indexOf(t);e>=0&&(this.uploadAreas[e].destroy(),this.uploadAreas.splice(e,1))},t}();t.Uploader=s;var l=function(){function e(t,e){this.options=t,this.callbacks=e,this.queuedFiles=[],this.setFullOptions(),this.setFullCallbacks()}return e.prototype.addFiles=function(e){var o=this;e.forEach(function(e){o.queuedFiles.push(e),e.guid=a(),e.uploadStatus=t.uploadStatus.queued,e.remove=n(e.remove,function(){o.removeFile(e)}),o.callbacks.onFileAddedCallback(e)}),this.filesChanged()},e.prototype.removeFile=function(t,e){void 0===e&&(e=!1);var n=this.queuedFiles.indexOf(t);0>n||(this.deactivateFile(t),this.queuedFiles.splice(n,1),this.callbacks.onFileRemovedCallback(t),e||this.filesChanged())},e.prototype.clearFiles=function(){var t=this;this.queuedFiles.forEach(function(e){return t.deactivateFile(e)}),this.queuedFiles=[]},e.prototype.filesChanged=function(){this.options.autoRemove&&this.removeFinishedFiles(),this.options.autoStart&&this.startWaitingFiles(),this.callbacks.onQueueChangedCallback(this.queuedFiles),this.checkAllFinished()},e.prototype.checkAllFinished=function(){var e=this.queuedFiles.filter(function(e){return[t.uploadStatus.queued,t.uploadStatus.uploading].indexOf(e.uploadStatus)>=0});0==e.length&&this.callbacks.onAllFinishedCallback()},e.prototype.setFullOptions=function(){this.options.maxParallelUploads=this.options.maxParallelUploads||0,this.options.autoStart=this.options.autoStart||!1,this.options.autoRemove=this.options.autoRemove||!1},e.prototype.setFullCallbacks=function(){var t=this;this.callbacks.onFileAddedCallback=this.callbacks.onFileAddedCallback||function(){},this.callbacks.onFileRemovedCallback=this.callbacks.onFileRemovedCallback||function(){},this.callbacks.onAllFinishedCallback=this.callbacks.onAllFinishedCallback||function(){},this.callbacks.onQueueChangedCallback=this.callbacks.onQueueChangedCallback||function(){},this.callbacks.onFileStateChangedCallback=function(){return t.filesChanged()}},e.prototype.startWaitingFiles=function(){this.getWaitingFiles().forEach(function(t){return t.start()})},e.prototype.removeFinishedFiles=function(){var e=this;this.queuedFiles.filter(function(e){return[t.uploadStatus.uploaded,t.uploadStatus.failed,t.uploadStatus.canceled].indexOf(e.uploadStatus)>=0}).forEach(function(t){return e.removeFile(t,!0)})},e.prototype.deactivateFile=function(e){e.uploadStatus==t.uploadStatus.uploading&&e.cancel(),e.uploadStatus=t.uploadStatus.removed,e.cancel=function(){},e.remove=function(){},e.start=function(){}},e.prototype.getWaitingFiles=function(){if(!this.options.autoStart)return[];var e=this.queuedFiles.filter(function(e){return e.uploadStatus==t.uploadStatus.queued});if(this.options.maxParallelUploads>0){var n=this.queuedFiles.filter(function(e){return e.uploadStatus==t.uploadStatus.uploading}).length,a=this.options.maxParallelUploads-n;if(0>=a)return[];e=e.slice(0,a)}return e},e}();t.UploadQueue=l;var r=function(){function t(){}return t.queued="queued",t.uploading="uploading",t.uploaded="uploaded",t.failed="failed",t.canceled="canceled",t.removed="removed",t}();t.UploadStatusStatic=r,t.uploadStatus=r}(pu||(pu={}));