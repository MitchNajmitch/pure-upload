var UploadStatusStatic=function(){function t(){}return t.queued="queued",t.uploading="uploading",t.uploaded="uploaded",t.failed="failed",t.canceled="canceled",t}(),uploadStatus=UploadStatusStatic,getUploadCore=function(t){return new UploaderCore(t)},UploaderCore=function(){function t(t){this.options=t,this.options=this.getFullOptions(t)}return t.prototype.upload=function(t){var e=this,o=this.castFiles(t);o.forEach(function(t){return e.processFile(t)})},t.prototype.processFile=function(t){var e=this.createRequest();this.setCallbacks(e,t),this.send(e,t)},t.prototype.castFiles=function(t){var e;return e="object"==typeof t?Object.keys(t).map(function(e){return t[e]}):t,e.forEach(function(t){t.uploadStatus=uploadStatus.uploading,t.responseCode=0,t.responseText="",t.progress=0,t.sentBytes=0,t.cancel=function(){}}),e},t.prototype.createRequest=function(){var t=new XMLHttpRequest;return t.open(this.options.method,this.options.url,!0),t.withCredentials=!!this.options.withCredentials,this.setHeaders(t),t},t.prototype.setHeaders=function(t){var e=this;this.options.headers.Accept=this.options.headers.Accept||"application/json",this.options.headers["Cache-Control"]=this.options.headers["Cache-Control"]||"no-cache",this.options.headers["X-Requested-With"]=this.options.headers["X-Requested-With"]||"XMLHttpRequest",Object.keys(this.options.headers).forEach(function(o){var n=e.options.headers[o];void 0!=n&&t.setRequestHeader(o,n)})},t.prototype.setCallbacks=function(t,e){var o=this;e.cancel=function(){t.abort(),e.uploadStatus=uploadStatus.canceled,o.options.onCancelledCallback(e)},t.onload=function(n){return o.onload(e,t)},t.onerror=function(){return o.handleError(e,t)},t.upload.onprogress=function(t){return o.updateProgress(e,t)}},t.prototype.send=function(t,e){var o=this.createFormData(e);this.options.onUploadStartedCallback(e),t.send(o)},t.prototype.createFormData=function(t){var e=this,o=new FormData;return Object.keys(this.options.params).forEach(function(t){var n=e.options.params[t];void 0!=n&&o.append(t,n)}),o.append("file",t,t.name),o},t.prototype.handleError=function(t,e){t.uploadStatus=uploadStatus.failed,this.setResponse(t,e),this.options.onErrorCallback(t),this.options.onFinishedCallback(t)},t.prototype.updateProgress=function(t,e){null!=e?(t.progress=Math.round(100*(e.loaded/e.total)),t.sentBytes=e.loaded):(t.progress=100,t.sentBytes=t.size),t.uploadStatus=100===t.progress?uploadStatus.uploaded:uploadStatus.uploading,this.options.onProgressCallback(t)},t.prototype.onload=function(t,e){4===e.readyState&&(100!=t.progress&&this.updateProgress(t),200===e.status?this.finished(t,e):this.handleError(t,e))},t.prototype.finished=function(t,e){t.uploadStatus=uploadStatus.uploaded,this.setResponse(t,e),this.options.onUploadedCallback(t),this.options.onFinishedCallback(t)},t.prototype.setResponse=function(t,e){t.responseCode=e.status,t.responseText=e.statusText||e.status?e.status.toString():"Invalid response from server"},t.prototype.getFullOptions=function(t){return{url:t.url,method:t.method,headers:t.headers||{},params:t.params||{},withCredentials:t.withCredentials||!1,onProgressCallback:t.onProgressCallback||function(){},onCancelledCallback:t.onCancelledCallback||function(){},onFinishedCallback:t.onFinishedCallback||function(){},onUploadedCallback:t.onUploadedCallback||function(){},onErrorCallback:t.onErrorCallback||function(){},onUploadStartedCallback:t.onUploadStartedCallback||function(){}}},t}(),UploadQueue=function(){function t(){this.queuedFiles=[]}return t.prototype.addFiles=function(t){var e=this;t.forEach(function(t){e.queuedFiles.push(t),t.uploadStatus=uploadStatus.queued,t.remove=function(){return e.removeFile(t)}})},t.prototype.removeFile=function(t){var e=this.queuedFiles.indexOf(t);0>e||(this.deactivateFile(t),this.queuedFiles.splice(e,1))},t.prototype.deactivateFile=function(t){t.uploadStatus==uploadStatus.uploading&&t.cancel(),t.cancel=function(){},t.remove=function(){},t.start=function(){}},t.prototype.getWaitingFiles=function(t){void 0===t&&(t=0);var e=this.queuedFiles.filter(function(t){return t.uploadStatus==uploadStatus.queued});if(t>0){var o=this.queuedFiles.filter(function(t){return t.uploadStatus==uploadStatus.uploading}).length,n=t-o;if(0>=n)return[];e=e.slice(0,n)}return e},t.prototype.clearFiles=function(){var t=this;this.queuedFiles.forEach(function(e){return t.deactivateFile(e)}),this.queuedFiles=[]},t}(),UploadArea=function(){function t(t,e,o){this.targetElement=t,this.uploadAreaOptions=e,this.queue=o}return t.prototype.init=function(){this.uploadCore=getUploadCore(this.uploadAreaOptions)},t.prototype.setupListeners=function(){},t.prototype.setupHiddenInput=function(){},t}(),Uploader=function(){function t(){}return t.prototype.setOptions=function(t){this.uploaderOptions=t},t.prototype.registerArea=function(t,e){var o=new UploadArea(t,e,this.queue);o.init(),this.uploadAreas.push(o)},t.prototype.unregisterArea=function(t){var e=this.uploadAreas.indexOf(t);e>=0&&this.uploadAreas.splice(e,1)},t}();