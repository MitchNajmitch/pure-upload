var pu;!function(t){function e(t,e,i,n){if(n)t.addEventListener(e,i);else{var o=t;o.attachEvent?o.attachEvent("on"+e,i):o[e]=i}}function i(t,e){var i;return i="object"==typeof t?u(r(t),function(e){return t[e]}):t,o(i,function(t){t.uploadStatus=e||t.uploadStatus,t.responseCode=t.responseCode||0,t.responseText=t.responseText||"",t.progress=t.progress||0,t.sentBytes=t.sentBytes||0,t.cancel=t.cancel||function(){}}),i}function n(t,e){if(!t)return null;var i=[];return o(t,function(t){e(t)&&i.push(t)}),i}function o(t,e){if(t)for(var i=0;i<t.length;i++)e(t[i],i)}function a(t,e,i){return void 0===i&&(i=!1),t?i?function(){e(),t()}:function(){t(),e()}:e}function s(){var t=(new Date).getTime(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?i:3&i|8).toString(16)});return e}function l(t,e){if(!t)return-1;for(var i=0;i<t.length;i++)if(t[i]===e)return i;return-1}function r(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(i);return e}function u(t,e){if(!t)return null;var i=[];return o(t,function(t){i.push(e(t))}),i}function c(t,e,i,n){if(n)t.removeEventListener(e,i);else{var o=t;o.detachEvent?o.detachEvent("on"+e,i):o[e]=null}}t.addEventHandler=e,t.castFiles=i,t.filter=n,t.forEach=o,t.decorateSimpleFunction=a,t.getUploadCore=function(t,e){return new d(t,e)},t.getUploader=function(t,e){return new h(t,e)},t.newGuid=s,t.indexOf=l,t.keys=r,t.map=u,t.removeEventHandler=c;var p=function(){function n(e,i,n){this.targetElement=e,this.options=i,this.uploader=n,this.uploadCore=t.getUploadCore(this.options,this.uploader.queue.callbacks),this.setFullOptions(i),this.setupHiddenInput()}return n.prototype.destroy=function(){this.unregisterOnClick&&this.unregisterOnClick(),this.unregisterOnDrop&&this.unregisterOnDrop(),this.unregisterOnChange&&this.unregisterOnChange(),this.unregisterOnDragOver&&this.unregisterOnDragOver(),this.targetElement.removeEventListener("dragover",this.onDrag),this.targetElement.removeEventListener("drop",this.onDrop),document.body.removeChild(this.fileInput)},n.prototype.setFullOptions=function(t){this.options.maxFileSize=t.maxFileSize||1024,this.options.allowDragDrop=this.uploader.isFileApi&&(void 0===t.allowDragDrop||null===t.allowDragDrop?!0:t.allowDragDrop),this.options.clickable=void 0===t.clickable||null===t.clickable?!0:t.clickable,this.options.accept=t.accept||"*.*",this.options.multiple=this.uploader.isFileApi&&(void 0===t.multiple||null===t.multiple?!0:t.multiple)},n.prototype.putFilesToQueue=function(t){var e=this,n=i(t);o(n,function(t){e.validateFile(t)&&(t.start=function(){e.uploadCore.upload([t]),t.start=function(){}})}),this.uploader.queue.addFiles(n)},n.prototype.validateFile=function(e){return this.isFileSizeValid(e)?!0:(e.uploadStatus=t.uploadStatus.failed,e.responseText="The size of this file exceeds the "+this.options.maxFileSize+" MB limit.",!1)},n.prototype.setupHiddenInput=function(){var t=this;this.fileInput=document.createElement("input"),this.fileInput.setAttribute("type","file"),this.fileInput.setAttribute("accept",this.options.accept),this.fileInput.style.display="none";var i=function(e){return t.onChange(e)};if(e(this.fileInput,"change",i,this.uploader.isFileApi),this.unregisterOnChange=function(){return c(t.fileInput,"change",onchange,t.uploader.isFileApi)},this.options.multiple&&this.fileInput.setAttribute("multiple",""),this.options.clickable){var n=function(){return t.onClick()};e(this.targetElement,"click",n,this.uploader.isFileApi),this.unregisterOnClick=function(){return c(t.targetElement,"click",n,t.uploader.isFileApi)}}if(this.options.allowDragDrop){var o=function(e){return t.onDrag(e)};e(this.targetElement,"dragover",o,this.uploader.isFileApi),this.unregisterOnDragOver=function(){return c(t.targetElement,"dragover",o,t.uploader.isFileApi)};var a=function(e){return t.onDrop(e)};e(this.targetElement,"drop",a,this.uploader.isFileApi),this.unregisterOnDrop=function(){return c(t.targetElement,"drop",a,t.uploader.isFileApi)}}document.body.appendChild(this.fileInput)},n.prototype.onChange=function(t){var e=t.target?t.target.files?t.target.files:t.target.value?[{name:t.target.value.replace(/^.+\\/,"")}]:[]:this.fileInput.value?[{name:this.fileInput.value.replace(/^.+\\/,"")}]:[];e.length&&this.putFilesToQueue(e)},n.prototype.onDrag=function(t){var e;try{e=t.dataTransfer.effectAllowed}catch(i){}t.dataTransfer.dropEffect="move"===e||"linkMove"===e?"move":"copy",this.stopEventPropagation(t)},n.prototype.onDrop=function(t){if(this.stopEventPropagation(t),t.dataTransfer){var e=t.dataTransfer.files;if(e.length){this.options.multiple||(e=[e[0]]);var i=t.dataTransfer.items;i&&i.length&&null!==i[0].webkitGetAsEntry?(this.options.multiple||(i=[i[0]]),this.addFilesFromItems(i)):this.handleFiles(e)}}},n.prototype.onClick=function(){this.fileInput.value="",this.fileInput.click()},n.prototype.addFilesFromItems=function(t){for(var e,i=0;i<t.length;i++){var n=t[i];n.webkitGetAsEntry&&(e=n.webkitGetAsEntry())?e.isFile?this.putFilesToQueue([n.getAsFile()]):e.isDirectory&&this.processDirectory(e,e.name):n.getAsFile&&(n.kind&&"file"!==n.kind||this.putFilesToQueue([n.getAsFile()]))}},n.prototype.processDirectory=function(t,e){var i=t.createReader(),n=this,o=function(t){for(var i=0;i<t.length;i++){var o=t[i];o.isFile?o.file(function(t){"."!==t.name.substring(0,1)&&(t.fullPath=""+e+"/"+t.name,n.putFilesToQueue([t]))}):o.isDirectory&&n.processDirectory(o,""+e+"/"+o.name)}};i.readEntries(o,function(t){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log(t):void 0})},n.prototype.handleFiles=function(t){for(var e=0;e<t.length;e++)this.putFilesToQueue([t[e]])},n.prototype.isFileSizeValid=function(t){var e=1024*this.options.maxFileSize*1024;return t.size>e?!1:!0},n.prototype.stopEventPropagation=function(t){return t.stopPropagation(),t.preventDefault?void t.preventDefault():t.returnValue=!1},n}();t.UploadArea=p;var d=function(){function e(t,e){void 0===e&&(e={}),this.options=t,this.callbacks=e,this.setFullOptions(t),this.setFullCallbacks(e)}return e.prototype.upload=function(e){var n=this,a=i(e,t.uploadStatus.uploading);o(a,function(t){return n.processFile(t)})},e.prototype.processFile=function(t){var e=this.createRequest(t);this.setCallbacks(e,t),this.send(e,t)},e.prototype.createRequest=function(t){var e=new XMLHttpRequest,i="function"==typeof this.options.url?this.options.url(t):this.options.url;return e.open(this.options.method,i,!0),e.withCredentials=!!this.options.withCredentials,this.setHeaders(e,t.name),e},e.prototype.setHeaders=function(t,e){var i=this;this.options.headers.Accept||t.setRequestHeader("Accept","application/json"),this.options.headers["Cache-Control"]||t.setRequestHeader("Cache-Control","no-cache"),this.options.headers["X-Requested-With"]||t.setRequestHeader("X-Requested-With","XMLHttpRequest"),o(r(this.options.headers),function(e){var n=i.options.headers[e];void 0!==n&&null!==n&&t.setRequestHeader(e,n)})},e.prototype.setCallbacks=function(e,i){var n=this;i.cancel;i.cancel=a(i.cancel,function(){e.abort(),i.uploadStatus=t.uploadStatus.canceled,n.callbacks.onCancelledCallback(i),n.callbacks.onFileStateChangedCallback(i),n.callbacks.onFinishedCallback(i)},!0),e.onload=function(t){return n.onload(i,e)},e.onerror=function(){return n.handleError(i,e)},e.upload.onprogress=function(t){return n.updateProgress(i,t)}},e.prototype.send=function(t,e){var i=this.createFormData(e);this.callbacks.onUploadStartedCallback(e),this.callbacks.onFileStateChangedCallback(e),t.send(i)},e.prototype.createFormData=function(t){var e=this,i=new FormData;return o(r(this.options.params),function(t){var n=e.options.params[t];void 0!==n&&null!==n&&i.append(t,n)}),i.append("file",t,t.name),i},e.prototype.handleError=function(e,i){e.uploadStatus=t.uploadStatus.failed,this.setResponse(e,i),this.callbacks.onErrorCallback(e),this.callbacks.onFileStateChangedCallback(e),this.callbacks.onFinishedCallback(e)},e.prototype.updateProgress=function(t,e){null!==e?e.lengthComputable?(t.progress=Math.round(100*(e.loaded/e.total)),t.sentBytes=e.loaded):(t.progress=0,t.sentBytes=0):(t.progress=100,t.sentBytes=t.size),this.callbacks.onProgressCallback(t)},e.prototype.onload=function(t,e){4===e.readyState&&(100!==t.progress&&this.updateProgress(t),200===e.status?this.finished(t,e):this.handleError(t,e))},e.prototype.finished=function(e,i){e.uploadStatus=t.uploadStatus.uploaded,this.setResponse(e,i),this.callbacks.onUploadedCallback(e),this.callbacks.onFileStateChangedCallback(e),this.callbacks.onFinishedCallback(e)},e.prototype.setResponse=function(t,e){t.responseCode=e.status,t.responseText=e.responseText||e.statusText||(e.status?e.status.toString():"Invalid response from server")},e.prototype.setFullOptions=function(t){this.options.url=t.url,this.options.method=t.method,this.options.headers=t.headers||{},this.options.params=t.params||{},this.options.withCredentials=t.withCredentials||!1},e.prototype.setFullCallbacks=function(t){this.callbacks.onProgressCallback=t.onProgressCallback||function(){},this.callbacks.onCancelledCallback=t.onCancelledCallback||function(){},this.callbacks.onFinishedCallback=t.onFinishedCallback||function(){},this.callbacks.onUploadedCallback=t.onUploadedCallback||function(){},this.callbacks.onErrorCallback=t.onErrorCallback||function(){},this.callbacks.onUploadStartedCallback=t.onUploadStartedCallback||function(){},this.callbacks.onFileStateChangedCallback=t.onFileStateChangedCallback||function(){}},e}();t.UploadCore=d;var h=function(){function t(t,e){void 0===t&&(t={}),void 0===e&&(e={}),this.isFileApi=!(!window.File||!window.FormData),this.setOptions(t),this.uploadAreas=[],this.queue=new f(t,e)}return t.prototype.setOptions=function(t){this.options=t},t.prototype.registerArea=function(t,e){var i=new p(t,e,this);return this.uploadAreas.push(i),i},t.prototype.unregisterArea=function(t){var e=l(this.uploadAreas,t);e>=0&&(this.uploadAreas[e].destroy(),this.uploadAreas.splice(e,1))},t}();t.Uploader=h;var f=function(){function e(t,e){this.queuedFiles=[],this.options=t,this.callbacks=e,this.setFullOptions(),this.setFullCallbacks()}return e.prototype.addFiles=function(e){var i=this;o(e,function(e){i.queuedFiles.push(e),e.guid=s(),e.remove=a(e.remove,function(){i.removeFile(e)}),i.callbacks.onFileAddedCallback(e),e.uploadStatus===t.uploadStatus.failed?i.callbacks.onErrorCallback&&i.callbacks.onErrorCallback(e):e.uploadStatus=t.uploadStatus.queued}),this.filesChanged()},e.prototype.removeFile=function(t,e){void 0===e&&(e=!1);var i=l(this.queuedFiles,t);0>i||(this.deactivateFile(t),this.queuedFiles.splice(i,1),this.callbacks.onFileRemovedCallback(t),e||this.filesChanged())},e.prototype.clearFiles=function(e,i){var a=this;void 0===e&&(e=[]),void 0===i&&(i=!1),i||(e=e.concat([t.uploadStatus.queued,t.uploadStatus.uploading])),o(n(this.queuedFiles,function(t){return l(e,t.uploadStatus)<0}),function(t){return a.removeFile(t,!0)}),this.callbacks.onQueueChangedCallback(this.queuedFiles)},e.prototype.filesChanged=function(){this.options.autoRemove&&this.removeFinishedFiles(),this.options.autoStart&&this.startWaitingFiles(),this.callbacks.onQueueChangedCallback(this.queuedFiles),this.checkAllFinished()},e.prototype.checkAllFinished=function(){var e=n(this.queuedFiles,function(e){return l([t.uploadStatus.queued,t.uploadStatus.uploading],e.uploadStatus)>=0});0===e.length&&this.callbacks.onAllFinishedCallback()},e.prototype.setFullOptions=function(){this.options.maxParallelUploads=this.options.maxParallelUploads||0,this.options.autoStart=this.options.autoStart||!1,this.options.autoRemove=this.options.autoRemove||!1},e.prototype.setFullCallbacks=function(){var t=this;this.callbacks.onFileAddedCallback=this.callbacks.onFileAddedCallback||function(){},this.callbacks.onFileRemovedCallback=this.callbacks.onFileRemovedCallback||function(){},this.callbacks.onAllFinishedCallback=this.callbacks.onAllFinishedCallback||function(){},this.callbacks.onQueueChangedCallback=this.callbacks.onQueueChangedCallback||function(){},this.callbacks.onFileStateChangedCallback=function(){return t.filesChanged()}},e.prototype.startWaitingFiles=function(){o(this.getWaitingFiles(),function(t){return t.start()})},e.prototype.removeFinishedFiles=function(){var e=this;o(n(this.queuedFiles,function(e){return l([t.uploadStatus.uploaded,t.uploadStatus.canceled],e.uploadStatus)>=0}),function(t){return e.removeFile(t,!0)})},e.prototype.deactivateFile=function(e){e.uploadStatus===t.uploadStatus.uploading&&e.cancel(),e.uploadStatus=t.uploadStatus.removed,e.cancel=function(){},e.remove=function(){},e.start=function(){}},e.prototype.getWaitingFiles=function(){if(!this.options.autoStart)return[];var e=n(this.queuedFiles,function(e){return e.uploadStatus===t.uploadStatus.queued});if(this.options.maxParallelUploads>0){var i=n(this.queuedFiles,function(e){return e.uploadStatus===t.uploadStatus.uploading}).length,o=this.options.maxParallelUploads-i;if(0>=o)return[];e=e.slice(0,o)}return e},e}();t.UploadQueue=f;var v=function(){function t(){}return t.queued="queued",t.uploading="uploading",t.uploaded="uploaded",t.failed="failed",t.canceled="canceled",t.removed="removed",t}();t.UploadStatusStatic=v,t.uploadStatus=v}(pu||(pu={}));